services:
  cobalt:
    image: ghcr.io/imputnet/cobalt:11

    init: true
    read_only: true
    restart: unless-stopped
    container_name: cobalt

    # ports:
    #   - 127.0.0.1:9000:9000

    # https://github.com/imputnet/cobalt/blob/main/docs/api-env-variables.md
    environment:
      API_URL: 'https://grab.cwel.casa'
      API_PORT: '1337'
      CORS_WILDCARD: '1'
      # COOKIE_PATH: '/cookies.json'

    networks:
      - internal

    labels:
      - traefik.enable=true
      - traefik.http.routers.cobalt.rule=Host(`grab.${CASA}`)
      - traefik.http.services.cobalt.loadbalancer.server.port=1337
      - traefik.docker.network=internal
      # Redirect old /api/json endpoint to /
      - traefik.http.middlewares.cobalt-api-redirect.redirectregex.regex=^(https?://[^/]+)/api/json$$
      - traefik.http.middlewares.cobalt-api-redirect.redirectregex.replacement=$${1}/
      - traefik.http.middlewares.cobalt-api-redirect.redirectregex.permanent=false
      - traefik.http.routers.cobalt.middlewares=cobalt-api-redirect

    # volumes:
    #   - ${DOCKERM}/cobalt/cookies.json:/cookies.json

  # yt-session-generator:
  #     image: ghcr.io/imputnet/yt-session-generator:webserver

  #     init: true
  #     restart: unless-stopped
  #     container_name: yt-session-generator
  #     labels:
  #       - com.centurylinklabs.watchtower.scope=cobalt

networks:
  internal:
    external: true
