services:
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
    volumes:
      - ${DOCKERM}/sonarr/app:/config
      - ${RUST}:/data
    restart: always
    healthcheck:
      test: ['CMD', 'curl', '--fail', 'http://127.0.0.1:8989/ping']
      interval: 30s
      retries: 10
    labels:
      - traefik.enable=true
      - traefik.http.routers.sonarr.rule=Host(`sonarr.${CASA}`)
      - traefik.docker.network=internal
      - traefik.http.services.sonarr.loadbalancer.server.port=8989

    networks:
      - internal
      - media

  radarr:
    image: lscr.io/linuxserver/radarr
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
    volumes:
      - ${DOCKERM}/radarr/app:/config
      - ${RUST}:/data
    restart: always
    healthcheck:
      test: ['CMD', 'curl', '--fail', 'http://127.0.0.1:7878/ping']
      interval: 30s
      retries: 10
    labels:
      - traefik.enable=true
      - traefik.http.routers.radarr.rule=Host(`radarr.${CASA}`)
      - traefik.docker.network=internal
      - traefik.http.services.radarr.loadbalancer.server.port=7878
    networks:
      - internal
      - media

  # lidarr:
  #   image: lscr.io/linuxserver/lidarr
  #   container_name: lidarr
  #   environment:
  #     - PUID=1000
  #     - PGID=1000
  #     - TZ=${TZ}
  #   volumes:
  #     - ${DOCKERM}/lidarr/app:/config
  #     - ${RUST}:/data
  #   restart: always
  #   healthcheck:
  #     test: ['CMD', 'curl', '--fail', 'http://127.0.0.1:8686/ping']
  #     interval: 30s
  #     retries: 10
  #   labels:
  #     - traefik.enable=true
  #     - traefik.http.routers.lidarr.rule=Host(`lidarr.${CASA}`)
  #     - traefik.docker.network=internal
  #     - traefik.http.services.lidarr.loadbalancer.server.port=8686
  #   networks:
  #     - internal
  #     - media

  whisparr:
    container_name: whisparr
    image: ghcr.io/hotio/whisparr:v3
    restart: unless-stopped
    networks:
      - internal
      - media
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=${TZ}
    volumes:
      - ${DOCKERM}/whisparr:/config
      - ${RUST}:/data
    labels:
      - traefik.enable=true
      - traefik.docker.network=internal
      - traefik.http.routers.whisparr.rule=Host(`whisparr.${CASA}`)
      - traefik.http.services.whisparr.loadbalancer.server.port=6969

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
    volumes:
      - ${DOCKERM}/prowlarr:/config
    restart: always
    healthcheck:
      test: ['CMD', 'curl', '--fail', 'http://127.0.0.1:9696/ping']
      interval: 30s
      retries: 10
    labels:
      - traefik.enable=true
      - traefik.http.routers.prowlarr.rule=Host(`prowlarr.${CASA}`)
      - traefik.docker.network=internal
      - traefik.http.services.prowlarr.loadbalancer.server.port=9696
    networks:
      - internal
      - media

  jellyseerr:
    image: ghcr.io/hotio/jellyseerr
    container_name: jellyseerr
    restart: always
    environment:
      - TZ=${TZ}
      - PUID=1000
      - PGID=1000
      - UMASK=002
    networks:
      - public
      - media
    ports:
      - '5055:5055'
    volumes:
      - ${DOCKERM}/jellyseerr:/config
    labels:
      - traefik.enable=true
      - traefik.http.routers.jellyseerr.rule=Host(`req.${DOMAIN}`)
      - traefik.docker.network=public
      - traefik.http.services.jellyseerr.loadbalancer.server.port=5055
      - kop.namespace=public

  flaresolverr:
    image: 21hsmw/flaresolverr:nodriver
    container_name: flaresolverr
    restart: always
    environment:
      - LOG_LEVEL=info
      - LOG_HTML=false
      - CAPTCHA_SOLVER=none
      - TZ=${TZ}
    labels:
      - traefik.enable=true
      - traefik.http.routers.flaresolverr.rule=Host(`flaresolverr.${CASA}`)
      - traefik.docker.network=internal
      - traefik.http.services.flaresolverr.loadbalancer.server.port=8191
    networks:
      - internal

  recyclarr:
    image: ghcr.io/recyclarr/recyclarr
    container_name: recyclarr
    user: 1000:1000
    networks:
      - media
    volumes:
      - ${DOCKERM}/recyclarr:/config
    environment:
      - TZ=${TZ}

  decluttarr:
    image: ghcr.io/manimatter/decluttarr:latest
    container_name: decluttarr
    restart: always
    networks:
      - media
    volumes:
      - ${RUST}:/data
    environment:
      TZ: ${TZ}
      PUID: 1000
      PGID: 1000

      LOG_LEVEL: INFO
      TEST_RUN: False
      TIMER: 10

      REMOVE_FAILED_DOWNLOADS: True
      REMOVE_FAILED_IMPORTS: True
      REMOVE_METADATA_MISSING: True
      REMOVE_MISSING_FILES: True
      REMOVE_SLOW: True
      REMOVE_STALLED: True
      REMOVE_UNMONITORED: False
      DETECT_DELETIONS: True
      PRIVATE_TRACKER_HANDLING: 'skip'
      PUBLIC_TRACKER_HANDLING: 'remove'

      SONARR: >
        - base_url: "http://sonarr:8989"
          api_key: "$SONARR_API_KEY"

      RADARR: >
        - base_url: "http://radarr:7878"
          api_key: "$RADARR_API_KEY"

      WHISPARR: >
        - base_url: "http://whisparr:6969"
          api_key: "$WHISPARR_API_KEY"

      QBITTORRENT: >
        - base_url: "http://gluetun:8080"
          username: "admin"
          password: "$QBIT_PASSWORD"

      SABNZBD: >
        - base_url: "http://sabnzbd:8080"
          api_key: "$SABNZBD_API_KEY"
          name: "SABnzbd"

  unpackerr:
    image: ghcr.io/unpackerr/unpackerr:latest
    container_name: unpackerr
    volumes:
      - ${RUST}/tor:/data/tor
    restart: always
    user: 1000:1000
    environment:
      - TZ=${TZ}
      - UN_DEBUG=true
      - UN_SONARR_0_URL=http://sonarr:8989/
      - UN_SONARR_0_API_KEY=${SONARR_API_KEY}
      - UN_RADARR_0_URL=http://radarr:7878/
      - UN_RADARR_0_API_KEY=${RADARR_API_KEY}
    networks:
      - media

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    networks:
      - internal
      - media
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
    volumes:
      - ${DOCKERM}/bazarr:/config
      - ${RUST}/movie:/movies
      - ${RUST}/tv:/tv
      - ${RUST}/anime:/anime
    restart: unless-stopped
    labels:
      - traefik.enable=true
      - traefik.http.routers.bazarr.rule=Host(`bazarr.${CASA}`)
      - traefik.http.services.bazarr.loadbalancer.server.port=6767
      - traefik.docker.network=internal

  # maintainerr:
  #   image: ghcr.io/jorenn92/maintainerr:latest # or jorenn92/maintainerr:latest
  #   container_name: maintainerr
  #   user: 1000:1000
  #   networks:
  #     - internal
  #     - media
  #   volumes:
  #     - ${DOCKERM}/maintainerr:/opt/data
  #   environment:
  #     - TZ=${TZ}
  #   restart: unless-stopped
  #   labels:
  #     - traefik.enable=true
  #     - traefik.http.routers.maintainerr.rule=Host(`maintainerr.${CASA}`)
  #     - traefik.docker.network=internal
  #     - traefik.http.services.maintainerr.loadbalancer.server.port=6246
  # recommendarr:
  #   image: tannermiddleton/recommendarr:latest
  #   container_name: recommendarr
  #   environment:
  #     - PUID=1000
  #     - PGID=1000
  #     - TZ=${TZ}
  #     - NODE_ENV=production
  #     - DOCKER_ENV=false
  #     - PORT=3000
  #     - PUBLIC_URL=https://recommendarr.${CASA}
  #     - FORCE_SECURE_COOKIES=true
  #   volumes:
  #     - ${DOCKERM}/recommendarr:/app/server/data
  #   restart: unless-stopped
  #   networks:
  #     - internal
  #   labels:
  #     - traefik.enable=true
  #     - traefik.http.routers.recommendarr.rule=Host(`recommendarr.${CASA}`)
  #     - traefik.docker.network=internal
  #     - traefik.http.services.recommendarr.loadbalancer.server.port=3000
